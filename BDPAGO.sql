CREATE DATABASE BDPAGOS
GO

use BDPAGOS

-------------CREACION DE TABLAS

CREATE TABLE USUARIO_CAJA(
	CODE_USER INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	USERNAME NVARCHAR(50) NOT NULL,
);

CREATE TABLE PRODUCTO(
	CODE_PRODUCT CHAR(4) NOT NULL PRIMARY KEY ,
	DESRIPTION NVARCHAR(150) NOT NULL
);

CREATE TABLE CLIENTE(
	CODE_CLIENT INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	DNI NCHAR(8) NOT NULL,
	NAME NVARCHAR(100) NOT NULL,
	LASTNAME NVARCHAR(100) NOT NULL
);



CREATE TABLE PAGO(
ID_PAYMENT BIGINT IDENTITY(1,1) PRIMARY KEY,
CODE_PRODUCT CHAR(4),
CODE_CLIENT INT,
CODE_USER INT,
PAYMENT_DATE DATE,
PAYMENT_VALUE DECIMAL(10,2),
NOTE NVARCHAR(MAX),
STATUS BIT,
FOREIGN KEY (CODE_PRODUCT) REFERENCES PRODUCTO(CODE_PRODUCT),
FOREIGN KEY (CODE_CLIENT) REFERENCES CLIENTE(CODE_CLIENT),
FOREIGN KEY (CODE_USER) REFERENCES USUARIO_CAJA(CODE_USER));




--------------------LLENADO DE TABLAS

INSERT INTO USUARIO_CAJA(USERNAME) VALUES ('Maria')
INSERT INTO USUARIO_CAJA(USERNAME) VALUES ('Rosario')
INSERT INTO USUARIO_CAJA(USERNAME) VALUES ('Pedro')
INSERT INTO USUARIO_CAJA(USERNAME) VALUES ('Miguel')
INSERT INTO USUARIO_CAJA(USERNAME) VALUES ('Teodoro')

INSERT INTO PRODUCTO(CODE_PRODUCT,DESRIPTION) VALUES ('P001','Platinium')
INSERT INTO PRODUCTO(CODE_PRODUCT,DESRIPTION) VALUES ('P002','Riesgo')

INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('98913055','JAIME','NUÃ‘EZ')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('94498456','GLADYS','SAMBRANO')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('94409061','ALFREDO','BILOCURA')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('94398619','ANGEL','CHAO')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('93601315','ANGELINA','AGUSTINE')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('92855199','WILL','CRISPIN')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('91800161','DORA','SALAZAR')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('91293719','JOSE','MARTINES')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('91160123','MARIA','GUERRERO')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('88016562','LAURA','MENDOZA')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('94137125','PEDRO','CABEZAS')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('00000000','ABC','ABC')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('98798929','MILAGROS','SEGOVIA')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('97152019','VICTOR','PALENCIA')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('95047666','DANIEL','CHAVEZ')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('94751417','ANDREA','VALENZUELA')
INSERT INTO CLIENTE(DNI,NAME,LASTNAME) VALUES ('95174498','JOSE','GUERRERO')




INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','1','1','15/01/2019',200,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','13','1','15/01/2019',500,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','14','1','03/02/2019',200,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','17','1','05/02/2019',200,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','15','1','10/03/2019',800,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','16','1','05/03/2019',500,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','2','2','18/01/2019',1000,'OK',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','3','3','25/01/2019',2500,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','4','4','10/01/2019',1500,'',1)

INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','11','1','07/02/2019',1800,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','5','5','17/02/2019',1000,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','6','1','28/02/2019',1800,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','7','2','03/03/2019',2800,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','8','3','11/03/2019',3200,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','9','4','19/03/2019',1600,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','10','5','29/03/2019',3700,'',1)

INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','2','4','11/03/2019',400,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','13','3','20/02/2019',600,'',1)

INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','5','1','19/03/2019',200,'OK',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','17','5','25/03/2019',1200,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','6','1','12/03/2019',1600,'',1)

INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','1','1','02/03/2019',2000,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P001','13','2','13/02/2019',800,'',1)

INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','9','3','25/03/2019',1200,'',1)
INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES ('P002','10','5','29/03/2019',200,'',0)


------------------- PROCEDIMIENTOS ALMACENADOS

CREATE PROC SP_CRUD_PAGO(
@ID_PAYMENT BIGINT,
@CODE_PRODUCTO CHAR(4),
@CODE_CLIENT INT,
@CODE_USER INT,
@PAYMENT_DATE DATE,
@PAYMENT_VALUE DECIMAL(10,2),
@NOTE NVARCHAR(MAX),
@STATUS BIT,
@OPTION CHAR(1)
) AS BEGIN 
		IF(@OPTION = 'C') BEGIN
				
				INSERT INTO PAGO(CODE_PRODUCT,CODE_CLIENT,CODE_USER,PAYMENT_DATE,PAYMENT_VALUE,NOTE,STATUS) VALUES (@CODE_PRODUCTO,@CODE_CLIENT,@CODE_USER,@PAYMENT_DATE,@PAYMENT_VALUE,@NOTE,@STATUS)


		END
		IF(@OPTION = 'R') BEGIN 

			SELECT * FROM PAGO ORDER BY PAYMENT_DATE


		END
		IF(@OPTION = 'U') BEGIN
				
				UPDATE PAGO SET 
					CODE_PRODUCT=@CODE_PRODUCTO,
					CODE_CLIENT=@CODE_CLIENT,
					CODE_USER=@CODE_USER,
					PAYMENT_DATE=@PAYMENT_DATE,
					PAYMENT_VALUE=@PAYMENT_VALUE,
					NOTE=@NOTE,
					STATUS=@STATUS
				WHERE ID_PAYMENT = @ID_PAYMENT

		END
		IF(@OPTION = 'D') BEGIN
			
			DELETE FROM PAGO WHERE ID_PAYMENT=@ID_PAYMENT

		END

END
-------------------------------------------------

exec SP_CRUD_PAGO 0,'',0,0,'',0,'',0,'R'

-----------------------------------------------

CREATE PROC SP_REPORT_PAGO(
	@CODEPRODUCT CHAR(4),
	@DNI NCHAR(8),
	@CODE_USER INT,
	@OPTION TINYINT
)AS BEGIN
IF(@OPTION = 1) BEGIN 
	 SELECT PRO.DESRIPTION,CLI.NAME+' '+CLI.LASTNAME, FROM PRODUCTO PRO,CLIENTE CLI,PAGO PAG WHERE PAG.CODE_PRODUCT = PRO.CODE_PRODUCT AND PAG.CODE_CLIENT = CLI.CODE_CLIENT
END
IF(@OPTION = 2) BEGIN 

END
IF(@OPTION = 3) BEGIN 

END













